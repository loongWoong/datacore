# 调度服务 (Scheduler Service)

## 功能概述

调度服务是数据中台的一个核心微服务，负责管理和执行各种数据任务调度。该服务提供了完整的任务生命周期管理功能，包括任务创建、编辑、启动、停止、删除等操作。

## 主要特性

1. **任务管理**
   - 创建、编辑、删除调度任务
   - 支持多种调度类型（Cron表达式、固定频率、固定延迟）
   - 任务状态管理（运行中、已停止）

2. **任务执行**
   - 启动和停止任务
   - 任务执行历史记录
   - 执行日志查看

3. **监控告警**
   - 任务执行状态监控
   - 失败任务告警通知

4. **数据处理任务支持**
   - 数据库扫描任务：扫描MySQL数据库元数据并生成YAML文件
   - Model生成任务：根据扫描结果生成DBT模型文件
   - 元数据上传任务：将扫描结果上传到元数据服务

## API 接口

### 任务管理接口

- `GET /api/scheduler/jobs` - 获取任务列表
- `POST /api/scheduler/jobs` - 创建任务
- `GET /api/scheduler/jobs/{id}` - 获取任务详情
- `PUT /api/scheduler/jobs/{id}` - 更新任务
- `DELETE /api/scheduler/jobs/{id}` - 删除任务

### 任务控制接口

- `POST /api/scheduler/jobs/{id}/start` - 启动任务
- `POST /api/scheduler/jobs/{id}/stop` - 停止任务

## 前端页面

调度管理页面可以通过以下URL访问：
- `/scheduler` - 调度任务管理界面

页面功能包括：
- 任务列表展示
- 任务创建和编辑表单
- 任务状态控制（启动/停止）
- 任务删除操作

### 表单字段说明

**任务类型**
调度系统支持四种任务类型：
1. 通用任务：可配置各种类型的调度任务
2. 数据库扫描任务：扫描MySQL数据库元数据并生成YAML文件
3. Model生成任务：根据扫描结果生成DBT模型文件
4. 元数据上传任务：将扫描结果上传到元数据服务

**基本信息**
- 任务描述：任务的描述信息
- 任务组：任务所属的执行器组
- 负责人：任务负责人
- 报警邮箱：任务执行失败时的报警邮箱

**调度配置**
- 调度类型：支持Cron表达式、固定频率、固定延迟三种类型
- 调度配置：根据调度类型填写相应的配置信息
- 调度过期策略：任务错过触发时间时的处理策略
- 启用状态：任务是否启用

**数据库扫描配置**
- 数据源：从数据源服务获取的数据库连接信息
- 输出文件路径：扫描结果保存的文件路径，默认为metadata_scan_result.yaml
- 任务执行超时时间：任务执行的最大时间限制
- 失败重试次数：任务执行失败后的重试次数

**Model生成配置**
- 输入文件路径：扫描结果文件路径，默认为metadata_scan_result.yaml
- 模型文件目录：生成的DBT模型文件保存目录，默认为models
- 任务执行超时时间：任务执行的最大时间限制
- 失败重试次数：任务执行失败后的重试次数

**元数据上传配置**
- 元数据文件：要上传的元数据文件路径，默认为metadata_scan_result.yaml
- 任务执行超时时间：任务执行的最大时间限制
- 失败重试次数：任务执行失败后的重试次数

**通用任务执行器配置**
- 路由策略：任务在多个执行器实例间的路由策略
- 阻塞处理策略：任务并发执行时的处理策略
- 执行器任务handler：具体的任务执行方法
- 执行器任务参数：任务执行时传入的参数
- 任务执行超时时间：任务执行的最大时间限制
- 失败重试次数：任务执行失败后的重试次数
- 子任务ID：当前任务执行完成后触发的子任务
- GLUE类型：任务的实现方式

## 配置说明

服务默认运行在端口8085，可通过修改`application.yml`文件中的`server.port`配置项进行调整。

## 数据库表结构

调度服务使用以下主要数据表：
- `xxl_job_info` - 任务信息表
- `xxl_job_log` - 任务执行日志表
- `xxl_job_log_report` - 任务日志报告表
- `xxl_job_logglue` - 任务GLUE代码表
- `xxl_job_registry` - 执行器注册表

## 启动服务

```bash
mvn spring-boot:run
```

或者

```bash
java -jar target/scheduler-service-1.0.0.jar
```