# 报表服务 (Report Service)

报表服务是数据中台的重要组成部分，负责各类业务报表的生成、管理和展示。

## 功能特性

- **报表配置管理**：提供报表配置的创建、查询、更新、删除功能
- **报表生成服务**：支持简单报表和模板报表的生成
- **报表查询服务**：提供报表生成记录的查询功能
- **文件管理服务**：支持报表文件的下载和管理

## 技术架构

- **框架**：Spring Boot 3.x + MyBatis Plus
- **报表引擎**：Apache POI 5.x、JasperReports 6.x
- **数据库**：MySQL 8.x
- **缓存**：Redis 7.x
- **文件存储**：MinIO或本地文件系统
- **接口文档**：SpringDoc Swagger UI
- **构建工具**：Maven

## 服务架构

```
┌─────────────────────────────────────────────────────────────┐
│                   Report Service API Layer                  │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │
│  │ 配置管理 │  │ 报表生成 │  │ 报表查询 │  │ 文件管理 │   │
│  │ Controller│  │ Controller│  │ Controller│  │ Controller│   │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                   Service Layer                             │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │
│  │ 配置服务 │  │ 生成服务 │  │ 查询服务 │  │ 文件服务 │   │
│  │ Service  │  │ Service  │  │ Service  │  │ Service  │   │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                   Repository Layer                          │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │
│  │ 配置仓储 │  │ 生成仓储 │  │ 查询仓储 │  │ 文件仓储 │   │
│  │ Repository│  │ Repository│  │ Repository│  │ Repository│   │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                   Storage Layer                             │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │
│  │ MySQL    │  │ Redis    │  │ MinIO    │  │ Local FS │   │
│  │ (配置)    │  │ (缓存)    │  │ (文件存储) │  │ (文件存储) │   │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │
└─────────────────────────────────────────────────────────────┘
```

## 核心功能模块

### 1. 报表配置管理
- 报表配置的创建、查询、更新、删除
- 支持多种报表类型（简单报表、模板报表、仪表板）
- 支持多种数据源类型（SQL、API）
- 支持多种输出格式（Excel、PDF、HTML、CSV）

### 2. 报表参数管理
- 报表参数的定义和管理
- 支持多种参数类型（字符串、整数、日期、布尔值）
- 支持参数默认值和必填校验
- 支持参数选项配置（用于下拉框等）

### 3. 报表生成服务
- 支持简单报表生成（基于Apache POI）
- 支持模板报表生成（基于JasperReports）
- 支持异步生成报表
- 生成记录的完整跟踪

### 4. 报表查询服务
- 报表生成记录查询
- 支持按报表ID、生成状态等条件筛选
- 支持分页查询

### 5. 文件管理服务
- 报表文件下载
- 文件存储管理

## 数据库设计

### 主要数据表

1. **报表配置表** (report_config)
2. **报表参数表** (report_parameter)
3. **报表生成记录表** (report_generation_record)
4. **报表订阅表** (report_subscription)

## API接口

### 报表配置接口
- `POST /api/reports/config` - 创建报表配置
- `GET /api/reports/config` - 获取报表配置列表
- `GET /api/reports/config/{id}` - 获取报表配置详情
- `PUT /api/reports/config/{id}` - 更新报表配置
- `DELETE /api/reports/config/{id}` - 删除报表配置

### 报表生成接口
- `POST /api/reports/generate` - 生成报表
- `GET /api/reports/generate/records` - 获取生成记录列表
- `GET /api/reports/generate/download/{recordId}` - 下载报表文件

## 部署说明

### 环境要求
- JDK 17+
- MySQL 8.x
- Redis 7.x
- MinIO（可选）

### 部署步骤
1. 初始化数据库，执行建表脚本
2. 修改`application.yml`配置文件，设置正确的数据库、Redis连接信息
3. 使用Maven打包：`mvn clean package`
4. 运行服务：`java -jar report-service.jar`

## 性能优化

- 数据库索引优化
- Redis缓存热点数据
- 异步处理报表生成任务
- 文件存储优化

## 安全设计

- JWT Token认证
- RBAC权限控制
- 敏感数据脱敏
- 操作日志记录